# Система пассажиров

Независимая система пассажиров для игры Helicopter Taxi. Пассажиры - это автономные сущности, которые взаимодействуют с объектами сцены через коллайдеры.

> **ВАЖНО:** Для корректной работы пассажиров необходимо правильно настроить теги в Unity:
> - Тег `"ExitPoint"` должен быть назначен на объекты, к которым пассажиры будут двигаться (например, дочерние объекты порталов или тестовые объекты).
> - Тег `"Portal"` (если используются порталы) должен быть назначен на объекты порталов.
> - Тег `"Player"` или `"Helicopter"` должен быть назначен на объект вертолета.

## 1. Архитектура системы (для минимального теста)

### Структура GameObject:
```
Passenger (GameObject)
├── Sprite Renderer          # Визуал (опционально, если нет 3D‑модели)
├── Passenger (Script)       # Основная логика пассажира
├── ModelRoot (Child)        # Корневой объект 3D‑модели (опционально)
│   └── Animator             # Контроллер анимаций с bool "IsWalking"
└── TriggerZone (Child)      # Дочерний объект с триггер‑коллайдером
    └── PassengerTrigger (Script) # Обработка событий триггера
```

### Основной принцип (минимальный тест):
1.  У пассажира есть основной `Passenger` скрипт.
2.  У пассажира есть дочерний объект `TriggerZone` с `Collider2D`, у которого в инспекторе установлен флаг `Is Trigger`.
3.  На дочернем объекте `TriggerZone` висит скрипт `PassengerTrigger`.
4.  Когда в триггер `TriggerZone` попадает объект с тегом `"ExitPoint"`, пассажир начинает двигаться к нему.

---

## 2. Компоненты пассажира (для минимального теста)

### PassengerTrigger
Этот скрипт должен быть прикреплен к дочернему объекту `TriggerZone`.
Он обрабатывает только `OnTriggerEnter2D` и вызывает событие `OnExitPointDetected` при попадании в триггер объекта с заданным тегом.

**События:**
- `event OnExitPointDetected(Transform exitPoint)` — возникает, когда в триггер попадает объект с тегом `exitPointTag` (по умолчанию `"ExitPoint"`).

**Поля:**
- `exitPointTag` (string) — тег цели выхода (по умолчанию `"ExitPoint"`).

**Автонастройка:**
- В `OnValidate()` у `Collider2D` принудительно включается `isTrigger = true`.

### Passenger (основной скрипт)
Этот скрипт должен быть прикреплен к основному объекту пассажира.
Он подписывается на событие `OnExitPointDetected` от `PassengerTrigger` и начинает движение к точке.

**Поля (назначаются в инспекторе):**
- `passengerTrigger` (PassengerTrigger): Ссылка на компонент `PassengerTrigger` на дочернем объекте.
- `animator` (Animator, опционально): Используется для переключения `IsWalking`.
- `modelRoot` (Transform, опционально): Корень 3D‑модели для поворота по оси Y.
- `moveSpeed` (float): Скорость движения.
- `useRigidbody2DMovement` (bool): Если включено и присутствует `Rigidbody2D`, используется `MovePosition` в `FixedUpdate`.
- `rightYAngle`/`leftYAngle` (float): Углы поворота 3D‑модели по оси Y при движении вправо/влево.

**Рекомендации по Rigidbody2D:**
- Добавьте `Rigidbody2D` на корень пассажира.
- `Body Type = Kinematic`, `Gravity Scale = 0`.
- Заморозьте поворот по Z при необходимости (Constraints).

**Методы:**
- `MoveToTarget(Transform target)`: Начинает движение к указанной цели.

---

## 3. Минимальный тест

1.  Создайте объект пассажира (например, спрайт квадрата).
2.  Добавьте ему компонент `Passenger`.
3.  (Опционально) Добавьте `ModelRoot` (дочерний объект) и поместите туда 3D‑модель.
4.  (Опционально) Добавьте `Animator` на `ModelRoot` и настройте bool `IsWalking` для переходов Idle/Walk.
5.  Создайте дочерний объект `TriggerZone` у пассажира.
6.  Добавьте `Collider2D` на `TriggerZone` и включите `Is Trigger` (скрипт сам включит в `OnValidate`).
7.  Добавьте компонент `PassengerTrigger` на `TriggerZone`. При необходимости измените `exitPointTag` (по умолчанию `"ExitPoint"`).
8.  (Рекомендуется) Добавьте `Rigidbody2D` на корень пассажира: `Kinematic`, `Gravity Scale = 0`.
9.  В инспекторе `Passenger` назначьте ссылки на `PassengerTrigger`, `Animator` и `ModelRoot` (если используются).
10. Создайте отдельный объект (например, другой спрайт квадрата), добавьте `Collider2D` (Is Trigger) и назначьте тег `"ExitPoint"`.
11. Запустите сцену. Когда объект с тегом `exitPointTag` попадет в триггер пассажира, пассажир должен начать двигаться к нему по оси X, поворачивая 3D‑модель по Y.

---

## 4. Дальнейшая разработка

Это минимальная реализация для тестирования базового движения. В дальнейшем будут добавлены:
- Машина состояний пассажира.
- Взаимодействие с порталами (тег `"Portal"`).
- Взаимодействие с вертолетом (теги `"Player"`/`"Helicopter"`).
- Более сложная логика поведения.

Документация будет обновляться по мере развития системы.

---

## 5. Примечания по интеграции с упрощенными порталами

- Компонент `SimplePortal` автоматически:
  - Присваивает себе тег `"Portal"` в `OnValidate`.
  - Включает `isTrigger` у своего `Collider2D`.
  - Для `exitPoint` (если назначен) задаёт тег `"ExitPoint"` и включает `isTrigger` у его `Collider2D`.

Это упрощает подготовку сцены для минимального теста.